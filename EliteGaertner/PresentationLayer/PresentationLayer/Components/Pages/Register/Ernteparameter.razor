@page "/ernte-hochladen"
@rendermode InteractiveServer
@inject NavigationManager Nav

<div class="ernte-parameter-container">
    <div class="text-center mb-4">
        <img src="pictures/EliteGÃ¤rtner_logo.png" alt="EliteGÃ¤rtner Logo" style="width:50px;"/>
        <h2 class="elitegaertner-title mt-2" style="font-weight: 600; font-size: 1.5rem">EliteGÃ¤rtner.</h2>
    </div>
    <div class="form-layout">

        <div class="left-column">
            <div class="ernte-image-container">
                <img src="@HochgeladenesBild" alt="Erntebild" class="ernte-image" />
            </div>
            
            <button class="publish-button-under-image" 
                    @onclick="VerÃ¶ffentlichen" 
                    disabled="@(string.IsNullOrEmpty(SelectedTag))"
                    style="border-radius: 0 0 20px 20px; margin-top: -10px; @(string.IsNullOrEmpty(SelectedTag) ? "opacity: 0.5; cursor: not-allowed;" : "")">
                Ernte verÃ¶ffentlichen
            </button>
        </div>

        <div class="right-column">
            <h3 style="margin-top: 0;">GemÃ¼se</h3>
            <div class="tag-grid">
                @foreach (var tag in GemueseTags)
                {
                    <div class="tag @(SelectedTag == tag.Name ? "selected" : "")"
                         @onclick="() => ToggleTag(tag.Name)">
                        <span class="emoji">@tag.Emoji</span> @tag.Name
                    </div>
                }
            </div>

            <h3>Obst</h3>
            <div class="tag-grid">
                @foreach (var tag in ObstTags)
                {
                    <div class="tag @(SelectedTag == tag.Name ? "selected" : "")"
                         @onclick="() => ToggleTag(tag.Name)">
                        <span class="emoji">@tag.Emoji</span> @tag.Name
                    </div>
                }
            </div>
        </div>
    </div>
    <div class="parameter-row">
        <div class="input-group">
            <label>Gewicht (in g)</label>
            <input type="number" @bind="Gewicht" placeholder="z.B. 300" />
        </div>

        <div class="input-group">
            <label>GrÃ¶ÃŸe (in cm)</label>
            <input type="number" @bind="Groesse" placeholder="z.B. 25" />
        </div>
    </div>
    <h3 style="margin-top: 10px;">Kommentar</h3>
    <div class="input-group">
        <textarea maxlength="150" @bind="Kommentar"
                              placeholder="Beschreibe kurz deine Ernte..."></textarea>
        <div class="char-counter">@Kommentar.Length / 150</div>
    </div>
</div>


@code {
    public string HochgeladenesBild { get; set; } =
        "pictures/Testbilder/Gurken_01.jpg"; 

    public class TagItem(string name, string emoji)
    {
        public string Name { get; set; } = name;
        public string Emoji { get; set; } = emoji;
    }
    
    List<TagItem> GemueseTags = new()
    {
        new("Auberginen", "ğŸ†"),
        new("Gurken", "ğŸ¥’"),
        new("Tomaten", "ğŸ…"),
        new("KÃ¼rbisse", "ğŸƒ"),
        new("Paprika", "ğŸŒ¶ï¸"),
        new("Zucchini", "ğŸ¥’"),
        new("Kartoffeln", "ğŸ¥”"),
        new("Karotten", "ğŸ¥•"),
        new("Salate", "ğŸ¥¬"),
        new("Zwiebeln", "ğŸ§…")
    };

    List<TagItem> ObstTags = new()
    {
        new("Melonen", "ğŸ‰"),
        new("Ã„pfel", "ğŸ"),
        new("Birnen", "ğŸ"),
        new("Pfirsiche", "ğŸ‘"),
        new("Kirschen", "ğŸ’"),
        new("Erdbeeren", "ğŸ“"),
        new("Trauben", "ğŸ‡")
    };

    // Ã„NDERUNG: Einzelner String statt Liste (nullable, da am Anfang nichts gewÃ¤hlt ist)
    string? SelectedTag = null; 

    int? Groesse { get; set; }
    int? Gewicht { get; set; }
    string Kommentar { get; set; } = "";

    // Ã„NDERUNG: Logik fÃ¼r Einzelauswahl
    void ToggleTag(string tag)
    {
        if (SelectedTag == tag)
        {
            // Wenn man auf das bereits ausgewÃ¤hlte Tag klickt, wird es abgewÃ¤hlt
            SelectedTag = null;
        }
        else
        {
            // Neues Tag setzen (Ã¼berschreibt das alte automatisch)
            SelectedTag = tag;
        }
    }

    void VerÃ¶ffentlichen()
    {
        // Sicherheitshalber prÃ¼fen, obwohl der Button disabled sein sollte
        if (string.IsNullOrEmpty(SelectedTag)) return;

        Console.WriteLine("AusgewÃ¤hltes Tag: " + SelectedTag);
        Console.WriteLine($"GrÃ¶ÃŸe: {Groesse}, Gewicht: {Gewicht}");
        Console.WriteLine($"Kommentar: {Kommentar}");

        Nav.NavigateTo("/ProfilTest", forceLoad: true);
    }
}