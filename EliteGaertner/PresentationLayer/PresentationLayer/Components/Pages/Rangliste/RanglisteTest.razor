@page "/RanglisteTest"
@rendermode InteractiveServer
@inject NavigationManager Nav

<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght=600&display=swap" rel="stylesheet">


<div class="page-container background-style">
    
    <header class="top-bar">
        
        @* NEU: Titelausrichtung für Rangliste (Kein Link links) *@
        <div class="icon-wrapper left"></div> @* Abstandshalter für Symmetrie *@

        <h1 class="page-title">Ranglisten</h1>

        <div class="menu-icon-container">
            <span class="menu-icon" @onclick="ToggleLogoutMenu">☰</span>
        </div>
    </header>

    @if (_showLogout)
    {
    <div class="logout-menu">
        <p @onclick="NavigateToLogout">Logout ➜]</p>
    </div>
    }

    <div class="scroll-content rangliste-content">
        
        <div class="category-selector">
            <span class="current-category">@_currentCategory.DisplayName</span>
            <span class="dropdown-arrow" @onclick="ToggleCategoryMenu">▼</span>
        </div>
        
        @if (_showCategoryMenu)
        {
            <div class="category-dropdown-menu comic-box-dropdown">
                @foreach (var cat in _categories)
                {
                    <div class="dropdown-item" @onclick="() => SelectCategory(cat)">
                        @cat.DisplayName
                    </div>
                }
            </div>
        }

        <div class="rangliste-card comic-box-card">
            <div class="trophy-icon">
                <img src="pictures/Rangliste.png" alt="Rangliste" height="80" /> 
            </div>

            @foreach (var rank in _currentCategory.Ranking)
            {
                <div class="rank-entry @GetRankCssClass(rank.Rank)">
                    <div class="rank-info" @onclick="() => GoToProfile(rank.Username)">
                        <span class="rank-number">@GetRankPrefix(rank.Username)@rank.Rank</span>
                        <span class="username-display">@rank.Username</span>
                    </div>
                </div>
            }
        </div>
        
    </div>

    <footer class="bottom-nav">
        <div class="nav-item" @onclick="GoToMatches">
            <img src="pictures/MatchesIcon.png" alt="Matches" height="40" /> 
            <span>Matches</span>
            @* Roter Punkt (notification-dot) entfernt *@
        </div>
        
        <div class="nav-item" @onclick="GoToMainpage">
            <img src="pictures/EliteGärtner_logo.png" alt="EliteGärtner" height="40" /> 
            <span class="elitegaertner-title mt-2" style="font-weight: 600; font-size: 1.0rem">EliteGärtner.</span>
        </div>
        
        <div class="nav-item" @onclick="GoToProfile">
            <img src="pictures/Profil_04.png" alt="Profile" height="40" /> 
            <span>Profil</span>
        </div>
    </footer>
</div>

@code {
    public class RankEntry
    {
        public int Rank { get; set; }
        public string Username { get; set; } = "";
        public bool IsCurrentUser { get; set; }
    }
    
    public class Category
    {
        public string Id { get; set; } = "";
        public string DisplayName { get; set; } = "";
        public List<RankEntry> Ranking { get; set; } = new();
    }

    private bool _showLogout = false;
    private bool _showCategoryMenu = false;
    private Category _currentCategory = new();
    
    private readonly List<Category> _categories = new()
    {
        new Category
        {
            Id = "gurke",
            DisplayName = "Längste Gurke",
            Ranking = new List<RankEntry>
            {
                new RankEntry { Rank = 1, Username = "@user_name01" },
                new RankEntry { Rank = 2, Username = "@user_name02" },
                new RankEntry { Rank = 3, Username = "@user_name03" },
                new RankEntry { Rank = 4, Username = "@user_name04" },
                new RankEntry { Rank = 5, Username = "@user_name05" },
                new RankEntry { Rank = 17, Username = "Ich", IsCurrentUser = true }, 
            }
        },
        new Category
        {
            Id = "aubergine",
            DisplayName = "Größte Aubergine",
            Ranking = new List<RankEntry>
            {
                new RankEntry { Rank = 1, Username = "@AuberginenKing" },
                new RankEntry { Rank = 2, Username = "@TomatenMann" },
                new RankEntry { Rank = 3, Username = "@Gemüsegärtnerin" },
                new RankEntry { Rank = 4, Username = "@KrautundRüben" },
                new RankEntry { Rank = 5, Username = "@Karotte33" },
                new RankEntry { Rank = 12, Username = "Ich", IsCurrentUser = true }, 
            }
        }
    };

    protected override void OnInitialized()
    {
        _currentCategory = _categories.First();
    }
    
    private string GetRankCssClass(int rank)
    {
        if (rank == 1) return "rank-1";
        if (rank == 2) return "rank-2";
        if (rank == 3) return "rank-3";
        if (_currentCategory.Ranking.Any(r => r.Rank == rank && r.IsCurrentUser)) return "current-user-rank";
        return "default-rank";
    }

    private string GetRankPrefix(string username)
    {
        return username == "Ich" ? "" : "#";
    }

    private void ToggleCategoryMenu()
    {
        _showCategoryMenu = !_showCategoryMenu;
    }
    
    private void SelectCategory(Category category)
    {
        _currentCategory = category;
        _showCategoryMenu = false;
    }

    // --- Navigations-Methoden ---
    private void ToggleLogoutMenu()
    {
        _showLogout = !_showLogout;
    }

    private void NavigateToLogout()
    {
        Nav.NavigateTo("/Login", forceLoad: true);
    }

    private void GoToProfile(string username)
    {
        string userUrl = username.TrimStart('@');
        if (username.ToLower() == "ich")
        {
            Nav.NavigateTo("/ProfilTest", forceLoad: true);
        }
        else
        {
            Nav.NavigateTo($"/profil/{userUrl}", forceLoad: true);
        }
    }
    
    private void GoToMatches() => Nav.NavigateTo("/MatchesTest", forceLoad: true);
    private void GoToMainpage() => Nav.NavigateTo("/startseite", forceLoad: true);
    private void GoToProfile() => Nav.NavigateTo("/ProfilTest", forceLoad: true);
}

<style>

    /* Definiere die Hauptfarben und Schriftart für Konsistenz */
    :root {
        --main-purple: #8B45B3; /* Basis-Lilaton (Aubergine) */
        --rank-1-color: #A968D7; /* Dunklerer Lilaton für #1 (Simuliert) */
        --rank-2-color: #B98BE4; /* Mittlerer Lilaton für #2 (Simuliert) */
        --rank-3-color: #D3B9F0; /* Hellster Lilaton für #3 (Simuliert) */
        --border-color: #000;
        --default-gray: #ccc;
        --default-rank-text: var(--border-color);
    }

    .page-container {
        font-family: 'Patrick Hand', cursive, sans-serif;
        display: flex;
        flex-direction: column;
        height: 100vh;
        max-width: 100%;
        background-color: white;
        overflow: hidden;
    }

    .background-style {
        background-image: url('pictures/LightIconBackground.jpeg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        width: 100%;
        min-height: 100vh;
        font-family: 'Patrick Hand', cursive, sans-serif;
        padding-top: 1px;
    }

    /* --- TOP BAR (Aus Startseite/MatchesTest übernommen) --- */
    .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        border-bottom: 3px solid var(--border-color);
        background-color: #fff;
        z-index: 10;
        box-shadow: 0 4px 0 0 var(--border-color);
        flex-shrink: 0;
    }

    .page-title {
        font-size: 1.8rem;
        margin: 0;
        font-weight: bold;
        color: var(--border-color);
        flex-grow: 1;
        text-align: center;
    }

    .icon-wrapper {
        width: 60px; /* Für Symmetrie mit dem Menü-Container */
    }

    .menu-icon-container {
        cursor: pointer;
        width: 60px; /* Für Symmetrie mit dem Icon-Wrapper links */
        display: flex;
        justify-content: flex-end;
    }

    .menu-icon {
        font-size: 30px;
        line-height: 1;
        color: var(--border-color);
    }
    
    /* --- Logout-Menü (Comic-Stil aus Startseite übernommen) --- */
    .logout-menu {
        position: absolute;
        top: 60px;
        right: 15px;
        width: 150px;
        background-color: #fff;
        /* Comic-Karte Stil */
        border: 3px solid var(--border-color);
        border-radius: 8px;
        box-shadow: 3px 3px 0 0 var(--border-color);
        z-index: 20;
        padding: 5px 0;
    }

    .logout-menu p {
        padding: 5px 10px;
        margin: 0;
        cursor: pointer;
        font-size: 16px;
        text-align: right;
    }

    .logout-menu p:hover {
        background-color: #eee;
    }

    /* --- Ranglisten Inhalt und Kategorie-Auswahl --- */
    .scroll-content {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        position: relative;
    }

    .category-selector {
        text-align: center;
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 15px;
        cursor: pointer;
        color: var(--main-purple);
        user-select: none;
    }

    .dropdown-arrow {
        margin-left: 10px;
    }

    .category-dropdown-menu {
        position: absolute;
        top: 85px; /* Angepasst an den neuen Header-Stil */
        left: 50%;
        transform: translateX(-50%);
        width: 250px;
        background-color: #fff;
        z-index: 25;
        text-align: center;
        padding: 0;
    }

    /* Neue Comic-Box-Klassen für Dropdown und Ranglisten-Karte */
    .comic-box-dropdown {
        border: 3px solid var(--border-color);
        border-radius: 10px;
        box-shadow: 4px 4px 0 0 var(--border-color);
    }

    .dropdown-item {
        padding: 10px 15px;
        font-size: 1.3rem;
        cursor: pointer;
        border-bottom: 2px solid var(--border-color);
    }

    .dropdown-item:last-child {
        border-bottom: none;
    }

    .dropdown-item:hover {
        background-color: #f0f0f0;
    }


    /* --- Haupt-Ranglisten-Karte --- */
    .rangliste-card {
        width: 100%;
        max-width: 450px; 
        margin: 0 auto;
        border: 3px solid var(--border-color);
        border-radius: 10px;
        background-color: #fff;
        box-shadow: 5px 5px 0 0 var(--border-color);
        padding: 20px 15px;
    }

    .trophy-icon {
        text-align: center;
        margin-bottom: 25px;
    }
    
    /* --- Ranglisten-Einträge --- */
    .rank-entry {
        border-radius: 8px;
        padding: 10px 15px;
        margin-bottom: 15px;
        font-weight: bold;
        cursor: pointer;
        border: 2px solid var(--border-color);
        box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
        transition: all 0.2s;
        line-height: 1.2;
    }

    .rank-entry:hover {
        transform: translateY(-2px);
        box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
    }

    .rank-info {
        display: flex;
        gap: 10px;
    }

    .rank-number {
        font-size: 1.8rem;
        width: 50px;
    }

    .username-display {
        font-size: 1.8rem;
    }

    /* Stil für Platz #1: Dunkelster Ton, größte Schrift */
    .rank-1 {
        background-color: var(--rank-1-color);
        color: white;
        border-color: #000;
        box-shadow: 4px 4px 0 0 var(--border-color);
    }
    
    /* Stil für Platz #2 */
    .rank-2 {
        background-color: var(--rank-2-color);
        color: var(--border-color);
        border-color: #000;
        box-shadow: 3px 3px 0 0 var(--border-color);
    }
    
    /* Stil für Platz #3 */
    .rank-3 {
        background-color: var(--rank-3-color);
        color: var(--border-color);
        border-color: #000;
        box-shadow: 2px 2px 0 0 var(--border-color);
    }

    /* Stil für den aktuellen Benutzer */
    .current-user-rank {
        background-color: #fff;
        color: var(--main-purple);
        border: 3px dashed var(--main-purple);
        box-shadow: 0 0 0 3px #000, 3px 3px 0 0 #000;
    }

    /* Standard-Rang-Stil */
    .default-rank {
        background-color: #f5f5f5;
        color: var(--default-rank-text);
        border-color: var(--default-gray);
    }


    /* --- Bottom Nav (Aus Startseite übernommen) --- */
    .bottom-nav {
        display: flex;
        justify-content: space-around;
        padding: 10px 0 20px 0;
        background: white;
        border-top: 3px solid var(--border-color);
        z-index: 10;
        box-shadow: 0 -4px 0 0 var(--border-color);
        flex-shrink: 0;
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        font-size: 0.9rem;
        width: 80px;
        text-align: center;
        color: var(--border-color);
        transition: transform 0.2s;
        opacity: 1; 
        font-weight: bold; 
    }

    .nav-item:hover {
        transform: scale(1.05);
        opacity: 1; 
    }

    /* NEU: EliteGärtner-Titel Font für Bottom Nav */
    .elitegaertner-title {
        font-family: 'Playfair Display', serif;
        font-weight: 600;
        line-height: 1.2;
    }
    
</style>