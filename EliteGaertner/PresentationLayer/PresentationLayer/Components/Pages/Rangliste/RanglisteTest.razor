@page "/RanglisteTest"
@rendermode InteractiveServer
@inject NavigationManager Nav

<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

<div class="mobile-container">
    
    <header class="top-bar">
        <div class="page-title-spacer"></div>

        <div class="icon-wrapper right menu-wrapper">
            <span class="hamburger-icon" @onclick="ToggleLogoutMenu">☰</span>
            @if (showLogout)
            {
                <div class="logout-menu">
                    <p @onclick="NavigateToLogout">Logout &lt;</p>
                </div>
            }
        </div>
    </header>

    <div class="scroll-content rangliste-content">
        
        <div class="category-selector">
            <span class="current-category">@CurrentCategory.DisplayName</span>
            <span class="dropdown-arrow" @onclick="ToggleCategoryMenu">▼</span>
        </div>
        
        @if (showCategoryMenu)
        {
            <div class="category-dropdown-menu">
                @foreach (var cat in Categories)
                {
                    <div class="dropdown-item" @onclick="() => SelectCategory(cat)">
                        @cat.DisplayName
                    </div>
                }
            </div>
        }

        <div class="rangliste-card">
            <div class="trophy-icon">
                <img src="pictures/Rangliste.png" alt="Rangliste" height="80" /> 
            </div>

            @foreach (var rank in CurrentCategory.Ranking)
            {
                <div class="rank-entry @GetRankCssClass(rank.Rank)">
                    <div class="rank-info" @onclick="() => GoToProfile(rank.Username)">
                        <span class="rank-number">@GetRankPrefix(rank.Username)@rank.Rank</span>
                        <span class="username-display">@rank.Username</span>
                    </div>
                </div>
            }
        </div>
        
    </div>

    <footer class="bottom-nav">
        <div class="nav-item" @onclick="GoToMatches">
            <img src="pictures/MatchesIcon.png" alt="Matches" height="40" /> 
            <span>Matches</span>
            <div class="notification-dot small-dot">3</div>
        </div>
        
        <div class="nav-item" @onclick="GoToMainpage">
            <img src="pictures/EliteGärtner_logo.png" alt="EliteGärtner" height="40" /> 
            <span class="elitegaertner-title mt-2" style="font-weight: 600; font-size: 1.0rem">EliteGärtner.</span>
        </div>
        
        <div class="nav-item" @onclick="GoToProfile">
            <img src="pictures/Profil_04.png" alt="Profile" height="40" /> 
            <span>Profil</span>
        </div>
    </footer>
</div>

@code {
    public class RankEntry
    {
        public int Rank { get; set; }
        public string Username { get; set; } = "";
        public bool IsCurrentUser { get; set; }
    }
    
    public class Category
    {
        public string Id { get; set; } = "";
        public string DisplayName { get; set; } = "";
        public List<RankEntry> Ranking { get; set; } = new();
    }

    private bool showLogout = false;
    private bool showCategoryMenu = false;
    private Category CurrentCategory = new();
    
    private readonly List<Category> Categories = new()
    {
        new Category
        {
            Id = "gurke",
            DisplayName = "Längste Gurke",
            Ranking = new List<RankEntry>
            {
                new RankEntry { Rank = 1, Username = "@user_name01" },
                new RankEntry { Rank = 2, Username = "@user_name02" },
                new RankEntry { Rank = 3, Username = "@user_name03" },
                new RankEntry { Rank = 4, Username = "@user_name04" },
                new RankEntry { Rank = 5, Username = "@user_name05" },
                new RankEntry { Rank = 17, Username = "Ich", IsCurrentUser = true }, 
            }
        },
        new Category
        {
            Id = "aubergine",
            DisplayName = "Größte Aubergine",
            Ranking = new List<RankEntry>
            {
                new RankEntry { Rank = 1, Username = "@AuberginenKing" },
                new RankEntry { Rank = 2, Username = "@TomatenMann" },
                new RankEntry { Rank = 3, Username = "@Gemüsegärtnerin" },
                new RankEntry { Rank = 4, Username = "@KrautundRüben" },
                new RankEntry { Rank = 5, Username = "@Karotte33" },
                new RankEntry { Rank = 12, Username = "Ich", IsCurrentUser = true }, 
            }
        }
    };

    protected override void OnInitialized()
    {
        // Setze die Standardkategorie beim Start
        CurrentCategory = Categories.First();
    }
    
    // Hilfsfunktionen für CSS-Klassen und Anzeige
    private string GetRankCssClass(int rank)
    {
        if (rank == 1) return "rank-1";
        if (rank == 2) return "rank-2";
        if (rank == 3) return "rank-3";
        if (CurrentCategory.Ranking.Any(r => r.Rank == rank && r.IsCurrentUser)) return "current-user-rank";
        return "default-rank";
    }

    private string GetRankPrefix(string username)
    {
        return username == "Ich" ? "" : "#";
    }

    private void ToggleCategoryMenu()
    {
        showCategoryMenu = !showCategoryMenu;
    }
    
    private void SelectCategory(Category category)
    {
        CurrentCategory = category;
        showCategoryMenu = false;
    }

    // --- Navigations-Methoden ---
    private void ToggleLogoutMenu()
    {
        showLogout = !showLogout;
    }

    private void NavigateToLogout()
    {
        Nav.NavigateTo("/Login", forceLoad: true);
    }

    private void GoToProfile(string username)
    {
        string userUrl = username.TrimStart('@');
        if (username.ToLower() == "ich")
        {
            Nav.NavigateTo("/ProfilTest", forceLoad: true);
        }
        else
        {
            Nav.NavigateTo($"/profil/{userUrl}", forceLoad: true);
        }
    }
    
    private void GoToMatches() => Nav.NavigateTo("/MatchesTest", forceLoad: true);
    private void GoToMainpage() => Nav.NavigateTo("/startseite", forceLoad: true);
    private void GoToProfile() => Nav.NavigateTo("/ProfilTest", forceLoad: true);
}

<style>

    /* Definiere die Hauptfarben und Schriftart für Konsistenz */
    :root {
        --main-purple: #8B45B3; /* Basis-Lilaton (Aubergine) */
        --rank-1-color: #A968D7; /* Dunklerer Lilaton für #1 (Simuliert) */
        --rank-2-color: #B98BE4; /* Mittlerer Lilaton für #2 (Simuliert) */
        --rank-3-color: #D3B9F0; /* Hellster Lilaton für #3 (Simuliert) */
        --border-color: #000;
        --default-gray: #ccc;
        --default-rank-text: var(--border-color);
    }

    .mobile-container {
        font-family: 'Patrick Hand', cursive, sans-serif;
        display: flex;
        flex-direction: column;
        height: 100vh;
        max-width: 100%;
        background-color: white;
        overflow: hidden;
    }

    /* --- Top Bar (Header & Logout) --- */
    .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background: white;
        z-index: 20;
        border-bottom: 2px solid #ccc;
    }

    .page-title-spacer {
        width: 60px;
    }

    .icon-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        width: 60px;
    }

    .hamburger-icon {
        font-size: 2rem;
    }

    .menu-wrapper {
        position: relative;
        align-items: flex-end;
    }

    .logout-menu {
        position: absolute;
        top: 50px;
        right: 0px;
        width: 150px;
        background-color: #fff;
        border: 1px solid var(--border-color);
        border-radius: 5px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        z-index: 30;
        padding: 5px 0;
    }

    .logout-menu p {
        padding: 5px 10px;
        margin: 0;
        cursor: pointer;
        font-size: 16px;
        text-align: right;
    }

    /* --- Ranglisten Inhalt und Kategorie-Auswahl --- */
    .scroll-content {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        position: relative;
    }

    .category-selector {
        text-align: center;
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 15px;
        cursor: pointer;
        color: var(--main-purple);
        user-select: none;
    }

    .dropdown-arrow {
        margin-left: 10px;
    }

    .category-dropdown-menu {
        position: absolute;
        top: 50px;
        left: 50%;
        transform: translateX(-50%);
        width: 250px;
        background-color: #fff;
        border: 3px solid var(--border-color);
        border-radius: 10px;
        box-shadow: 4px 4px 0 0 var(--border-color);
        z-index: 25;
        text-align: center;
    }

    .dropdown-item {
        padding: 10px 15px;
        font-size: 1.3rem;
        cursor: pointer;
        border-bottom: 1px solid #eee;
    }

    .dropdown-item:last-child {
        border-bottom: none;
    }

    .dropdown-item:hover {
        background-color: #f0f0f0;
    }


    /* --- Haupt-Ranglisten-Karte --- */
    .rangliste-card {
        width: 100%;
        max-width: 450px; /* Vergrößerte Karte */
        margin: 0 auto;
        border: 3px solid var(--border-color);
        border-radius: 10px;
        background-color: #fff;
        box-shadow: 5px 5px 0 0 var(--border-color);
        padding: 20px 15px;
    }

    .trophy-icon {
        text-align: center;
        margin-bottom: 25px;
    }
    
    /* --- Ranglisten-Einträge --- */
    .rank-entry {
        border-radius: 8px;
        padding: 10px 15px;
        margin-bottom: 15px;
        font-weight: bold;
        cursor: pointer;
        border: 2px solid var(--border-color);
        box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
        transition: all 0.2s;
        line-height: 1.2;
    }

    .rank-entry:hover {
        transform: translateY(-2px);
        box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
    }

    .rank-info {
        display: flex;
        gap: 10px;
    }

    .rank-number {
        font-size: 1.8rem;
        width: 50px;
    }

    .username-display {
        font-size: 1.8rem;
    }

    /* Stil für Platz #1: Dunkelster Ton, größte Schrift */
    .rank-1 {
        background-color: var(--rank-1-color);
        color: white;
        font-size: 1.1em; /* etwas größer als default */
    }

    .rank-1 .rank-number, .rank-1 .username-display {
        font-size: 2.0rem;
    }

    /* Stil für Platz #2: Mittlerer Ton, mittlere Schrift */
    .rank-2 {
        background-color: var(--rank-2-color);
        color: white;
        font-size: 1.05em;
    }

    .rank-2 .rank-number, .rank-2 .username-display {
        font-size: 1.9rem;
    }

    /* Stil für Platz #3: Hellster Ton, kleinste Top-3-Schrift */
    .rank-3 {
        background-color: var(--rank-3-color);
        color: var(--border-color);
    }

    .rank-3 .rank-number, .rank-3 .username-display {
        font-size: 1.8rem;
    }

    /* Stil für Platz #4 und höher (Standard-Grau) */
    .default-rank {
        background-color: var(--default-gray);
        color: var(--default-rank-text);
        box-shadow: 1px 1px 0 rgba(0, 0, 0, 0.2);
    }

    .default-rank .rank-number, .default-rank .username-display {
        font-size: 1.5rem;
    }

    /* Stil für den aktuellen Benutzer ("Ich") */
    .current-user-rank {
        background-color: var(--main-purple);
        color: white;
        border: 3px solid var(--border-color);
        box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.5);
        font-size: 1.1em;
    }

    .current-user-rank .rank-number, .current-user-rank .username-display {
        font-size: 2.0rem;
    }


    /* --- Bottom Nav (Übernahme) --- */
    .bottom-nav {
        display: flex;
        justify-content: space-around;
        align-items: flex-end;
        padding: 10px 0 20px 0;
        background: white;
        border-top: 1px solid #eee;
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        font-size: 0.9rem;
        width: 80px;
        text-align: center;
        color: black;
        position: relative;
    }

    .notification-dot {
        position: absolute;
        top: -5px;
        right: 15px;
        background-color: #D62828;
        color: white;
        font-size: 10px;
        font-weight: bold;
        border-radius: 50%;
        width: 15px;
        height: 15px;
        display: flex;
        justify-content: center;
        align-items: center;
        border: 1px solid var(--border-color);
    }
    .small-dot {
        top: 0;
        right: 15px;
        width: 10px;
        height: 10px;
        font-size: 7px;
    }
</style>