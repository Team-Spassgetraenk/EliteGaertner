@page "/ProfilTest"
@using Microsoft.AspNetCore.Components.Web
@inject NavigationManager Nav
@rendermode InteractiveServer

<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

<div class="page-container background-style">

    @* --- TOP BAR --- *@
    <header class="top-bar">
        <div class="icon-wrapper" @onclick="GoToRanks">
            <img src="pictures/Rangliste.png" alt="Rangliste" height="40" />
            <span class="icon-label">Rangliste</span>
        </div>

        <h1 class="page-title">Mein Profil</h1>

        <div class="header-right-action menu-wrapper">
            <span class="hamburger-icon" @onclick="ToggleLogoutMenu">☰</span>
            @if (_showLogout)
            {
            <div class="logout-menu comic-box">
                <p @onclick="NavigateToLogout">Logout &lt;</p>
            </div>
            }
        </div>
    </header>

    @* --- HAUPTBEREICH (Zweispaltig) --- *@
    <div class="main-profile-layout">

        @* LINKE SPALTE: Meine Informationen *@
        <aside class="left-column">
            <div class="profile-header-box comic-box">
                @* Profil Verwalten Button *@
                <div class="profile-manage-button-in-box" @onclick="GoToManageProfile">
                    <img src="pictures/EinstellungenIcon.png" alt="Einstellungen" height="22" />
                    <span class="manage-text">Profil verwalten</span>
                </div>

                <div class="profile-info">
                    <div class="profile-pic-placeholder">
                        <img src="pictures/Profilbilder/Profilbild_28.png" alt="Profilbild" class="profile-pic" />
                    </div>
                    <h2 class="username-display">@@MaisMädrescher</h2>
                </div>

                <div class="divider"></div>
                <p class="profile-description">@_bioText</p>
            </div>
        </aside>

        @* RECHTE SPALTE: Meine Galerie (Scrollbar) *@
        <main class="right-column">
            <div class="harvest-gallery-box comic-box gallery-scroll-container">
                <div class="harvest-grid">
                    @foreach (var item in GetGridItems())
                    {
                    <div class="grid-item comic-grid-item">
                        @if (item.IsImage)
                        {
                        <img src="@item.Path" alt="Erntebild" class="harvest-photo" />
                        }
                        else if (item.IsAddButton)
                        {
                        <div class="add-photo-box" @onclick="AddPhoto">
                                    <span class="plus-icon-circle">
                                        <span class="plus-icon">+</span>
                                    </span>
                        </div>
                        }
                    </div>
                    }
                </div>
            </div>
        </main>
    </div>

    @* --- BOTTOM NAV --- *@
    <footer class="bottom-nav">
        <div class="nav-item" @onclick="GoToMatches">
            <img src="pictures/MatchesIcon.png" alt="Matches" height="40" />
            <span>Matches</span>
        </div>
        <div class="nav-item" @onclick="GoToMainpage">
            <img src="pictures/EliteGärtner_logo.png" alt="EliteGärtner" height="40" />
            <span class="elitegaertner-title mt-2">EliteGärtner.</span>
        </div>
        <div class="nav-item active" @onclick="GoToProfile">
            <img src="pictures/Profil_04.png" alt="Profile" height="40" />
            <span>Profil</span>
        </div>
    </footer>
</div>

@code {
private string _bioText = "Hier steht die Profilbeschreibung... Leidenschaftlicher Züchter seltener Tomatensorten und Gurken-Enthusiast seit 2020.";
private List<string> _uploadedImages = new List<string>
{
    "pictures/Testbilder/Mais_01.png", 
    "pictures/Testbilder/Mais_02.png",
    "pictures/Testbilder/Mais_03.png"
};

private bool _showLogout = false;
private const int MaxContentItems = 8;

public class GridItem {
public bool IsImage { get; set; }
public bool IsAddButton { get; set; }
public string Path { get; set; } = "";
}

private List<GridItem> GetGridItems() {
var items = _uploadedImages.Select(path => new GridItem { IsImage = true, Path = path }).ToList();
if (items.Count < MaxContentItems) { items.Add(new GridItem { IsAddButton = true }); }
return items.Take(MaxContentItems).ToList();
}

private void ToggleLogoutMenu() => _showLogout = !_showLogout;
private void NavigateToLogout() => Nav.NavigateTo("/", forceLoad: true);
private void GoToRanks() => Nav.NavigateTo("/RanglisteTest", forceLoad: true);
private void GoToMatches() => Nav.NavigateTo("/MatchesTest", forceLoad: true);
private void GoToMainpage() => Nav.NavigateTo("/startseite", forceLoad: true);
private void GoToProfile() => Nav.NavigateTo("/ProfilTest", forceLoad: true);
private void GoToManageProfile() => Nav.NavigateTo("/profil/profilverwaltung", forceLoad: true);
private void AddPhoto() => Nav.NavigateTo("/ernte-hochladen", forceLoad: true);
}