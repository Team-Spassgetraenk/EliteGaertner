@page "/ProfilTest"
@using Microsoft.AspNetCore.Components.Web
@inject NavigationManager Nav
@rendermode InteractiveServer

<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

<div class="page-container background-style">

    @* --- TOP BAR: Rangliste, Titel und Menü --- *@
    <header class="top-bar">

        @* Ranglisten-Icon (links) *@
        <div class="icon-wrapper" @onclick="GoToRanks">
            <img src="pictures/Rangliste.png" alt="Rangliste" height="40" />
            <span class="icon-label">Rangliste</span>
        </div>

        @* Titel *@
        <h1 class="page-title">Mein Profil</h1>

        @* Hamburger Menü für Logout *@
        <div class="header-right-action menu-wrapper">
            <span class="hamburger-icon" @onclick="ToggleLogoutMenu">☰</span>
            @if (showLogout)
            {
            <div class="logout-menu comic-box">
                <p @onclick="NavigateToLogout">Logout &lt;</p>
            </div>
            }
        </div>
    </header>

    <div class="scroll-content">

        @* --- Profil-Header Box (Kombinierte Struktur) --- *@
        <div class="profile-header-box comic-box">

            @* ANGEPASST: Profil Verwalten Button oben rechts in der Box *@
            <div class="profile-manage-button-in-box" @onclick="GoToManageProfile">
                <img src="pictures/EinstellungenIcon.png" alt="Einstellungen" height="25" />
                <span class="manage-text">Profil verwalten</span>
            </div>

            <div class="profile-info">
                @* Profilbild (Placeholder) *@
                <div class="profile-pic-placeholder">
                    <img src="pictures/Profil_04.png" alt="Profilbild" class="profile-pic" />
                </div>

                @* Username *@
                <h2 class="username-display">@@user_name2</h2>
            </div>

            @* Bio/Beschreibung *@
            <p class="profile-description">@bioText</p>
        </div>

        @* NEU: Galerie-Box im Comic-Stil, die das Grid umschließt *@
        <div class="harvest-gallery-box comic-box">
            <div class="harvest-grid">

                @foreach (var item in GetGridItems())
                {
                <div class="grid-item comic-grid-item">
                    @if (item.IsImage)
                    {
                    <img src="@item.Path" alt="Erntebild" class="harvest-photo" />
                    }
                    else if (item.IsAddButton)
                    {
                    <div class="add-photo-box" @onclick="AddPhoto">
                                <span class="plus-icon-circle">
                                    <span class="plus-icon">+</span>
                                </span>
                    </div>
                    }
                </div>
                }
            </div>
        </div>
    </div>

    @* --- Bottom Nav (Startseite-Stil) --- *@
    <footer class="bottom-nav">
        <div class="nav-item" @onclick="GoToMatches">
            <img src="pictures/MatchesIcon.png" alt="Matches" height="40" />
            <span>Matches</span>
        </div>

        <div class="nav-item" @onclick="GoToMainpage">
            <img src="pictures/EliteGärtner_logo.png" alt="EliteGärtner" height="40" />
            <span class="elitegaertner-title mt-2">EliteGärtner.</span>
        </div>

        <div class="nav-item active" @onclick="GoToProfile">
            <img src="pictures/Profil_04.png" alt="Profile" height="40" />
            <span>Profil</span>
        </div>
    </footer>
</div>

@code {
private string bioText = "Hier steht die Profilbeschreibung... Leidenschaftlicher Züchter seltener Tomatensorten und Gurken-Enthusiast seit 2020.";
private List<string> uploadedImages = new List<string>
{
"pictures/Testbilder/Gurken_01.jpg",
"pictures/Testbilder/Gurken_01.jpg",
"pictures/Testbilder/Gurken_01.jpg",
"pictures/Testbilder/Gurken_01.jpg",
"pictures/Testbilder/Gurken_01.jpg",
"pictures/Testbilder/Gurken_01.jpg"
};

private bool showLogout = false;
// Maximal 7 Bilder + 1 Plus-Feld
private const int MaxContentItems = 8;

public class GridItem
{
public bool IsImage { get; set; }
public bool IsAddButton { get; set; }
public string Path { get; set; } = "";
}

private List<GridItem> GetGridItems()
{
var items = uploadedImages.Select(path => new GridItem { IsImage = true, Path = path }).ToList();

// Das Plus-Feld wird nur hinzugefügt, wenn die Max-Anzahl nicht erreicht ist.
if (items.Count < MaxContentItems)
{
items.Add(new GridItem { IsAddButton = true });
}

return items.Take(MaxContentItems).ToList();
}


private void ToggleLogoutMenu() => showLogout = !showLogout;
private void NavigateToLogout() => Nav.NavigateTo("/", forceLoad: true);
private void GoToRanks() => Nav.NavigateTo("/RanglisteTest", forceLoad: true);
private void GoToMatches() => Nav.NavigateTo("/MatchesTest", forceLoad: true);
private void GoToMainpage() => Nav.NavigateTo("/startseite", forceLoad: true);
private void GoToProfile() => Nav.NavigateTo("/ProfilTest", forceLoad: true);
private void GoToManageProfile() => Nav.NavigateTo("/profil/profilverwaltung", forceLoad: true);
private void AddPhoto() => Nav.NavigateTo("/ernte-hochladen", forceLoad: true);
}

<style>
    /* Globale Container und Schrift */
    .page-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        position: relative;
        overflow: hidden;
    }

    .background-style {
        background-image: url('pictures/LightIconBackground.jpeg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        width: 100%;
        min-height: 100vh;
        font-family: 'Patrick Hand', cursive, sans-serif;
    }

    /* --- TOP BAR (Einheitlicher Startseite-Stil) --- */
    .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        border-bottom: 3px solid #000;
        background-color: #fff;
        z-index: 10;
        box-shadow: 0 4px 0 0 #000;
        flex-shrink: 0;
    }

    .page-title {
        font-size: 28px;
        font-weight: bold;
        margin: 0;
        flex-grow: 1;
        text-align: center;
        color: #000;
    }

    /* Icon Wrapper (Rangliste) */
    .icon-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-weight: bold;
        font-size: 12px;
        cursor: pointer;
        width: 60px;
        transition: transform 0.2s;
    }

    .icon-wrapper:hover {
        transform: scale(1.05);
    }

    .icon-wrapper img {
        margin-bottom: 2px;
    }

    /* Rechtes Aktionsfeld (Hamburger Menü) */
    .header-right-action {
        width: 60px;
        display: flex;
        justify-content: flex-end;
    }

    /* Hamburger Menü und Logout */
    .menu-wrapper {
        position: relative;
    }

    .hamburger-icon {
        font-size: 30px;
        line-height: 1;
        color: #000;
        cursor: pointer;
    }

    .logout-menu {
        position: absolute;
        top: 45px;
        right: 0px;
        width: 150px;
        background-color: #fff;
        border: 3px solid #000;
        border-radius: 8px;
        box-shadow: 3px 3px 0 0 #000;
        z-index: 20;
        padding: 5px 0;
    }

    .logout-menu p {
        padding: 5px 10px;
        margin: 0;
        cursor: pointer;
        font-size: 16px;
        text-align: right;
    }

    .logout-menu p:hover {
        background-color: #eee;
    }

    /* --- CONTENT AREA & PROFIL BOX --- */
    .scroll-content {
        flex-grow: 1;
        padding: 20px 15px;
        overflow-y: auto;
    }

    .comic-box {
        /* Dickerer Rand für die Hauptboxen */
        border: 5px solid #000;
        border-radius: 10px;
        box-shadow: 6px 6px 0 0 #000; /* Größerer Shadow */
        background-color: #fff;
    }

    /* Profil Info Box */
    .profile-header-box {
        padding: 15px;
        margin-bottom: 20px;
        position: relative;
    }

    /* --- Profil Verwalten Button --- */
    .profile-manage-button-in-box {
        position: absolute;
        top: 15px;
        right: 15px;
        display: flex;
        align-items: center;
        background-color: #fff;
        border: 2px solid #000;
        border-radius: 25px;
        padding: 5px 12px;
        box-shadow: 3px 3px 0 0 #000;
        cursor: pointer;
        transition: transform 0.1s;
        z-index: 5;
    }

    .profile-manage-button-in-box:active {
        transform: translate(3px, 3px);
        box-shadow: 0 0 0 0 #000;
    }

    .profile-manage-button-in-box .manage-text {
        font-size: 18px;
        font-weight: bold;
        margin-right: 5px;
        white-space: nowrap;
        order: 2;
    }

    .profile-manage-button-in-box img {
        margin-right: 5px;
        order: 1;
    }


    .profile-info {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        padding-top: 10px;
    }

    .profile-pic-placeholder {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: 2px solid #000;
        overflow: hidden;
        margin-right: 15px;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #eee;
    }

    .profile-pic {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .username-display {
        font-size: 28px;
        font-weight: bold;
        margin: 0;
        color: #000;
    }

    .profile-description {
        font-size: 18px;
        margin-top: 5px;
        line-height: 1.3;
        margin-bottom: 0;
    }

    /* --- UMSCHLIEßENDE BOX --- */
    .harvest-gallery-box {
        /* Mehr Padding außen herum */
        padding: 15px;
        margin-bottom: 20px;
    }

    /* --- BILDER-RASTER (4 Spalten) --- */
    .harvest-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* teilt die photobox in 4 spalten auf */
        gap: 17px;
    }

    .grid-item {
        position: relative;
        width: 100%;
        /* 9:16 Hochformat */
        padding-bottom: 177.77%;
        overflow: hidden;
    }

    .comic-grid-item {
        background-color: #fff;
        /* Dickerer Rand für einzelne Bilder */
        border: 4px solid #000;
        border-radius: 8px;
        /* Angepasster Shadow */
        box-shadow: 4px 4px 0 0 #000;
    }

    .harvest-photo {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Plus-Symbol für Upload-Box */
    .add-photo-box {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #eee;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
    }

    .plus-icon-circle {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 4px solid #000;
        background-color: #fff;
        box-shadow: 4px 4px 0 0 #000;
    }

    .plus-icon {
        font-size: 60px;
        font-weight: bold;
        color: #000;
        line-height: 1;
    }

    .bottom-nav {
        display: flex;
        justify-content: space-around;
        padding: 10px 0 20px 0;
        background: white;
        border-top: 3px solid #000;
        z-index: 10;
        box-shadow: 0 -4px 0 0 #000;
        flex-shrink: 0;
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        font-size: 12px;
        font-weight: bold;
        position: relative;
        opacity: 1;
        transition: transform 0.2s;
        width: 80px;
        text-align: center;
    }

    .nav-item:hover {
        transform: scale(1.05);
        opacity: 1;
    }

    .elitegaertner-title {
        font-weight: 600;
        font-size: 1.0rem;
    }
</style>